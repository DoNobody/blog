## 安全意识

### 安全是什么？(information Security)[CIA]
> 保护数据被安全的使用
* 机密性
    > 引导人去做正确的事
  * 数据保护：加密、隔离、混淆、隐藏
  * 访问控制
* 完整性
  * 访问控制
  * 审计
  * 签名
* 可用性
  > 确保数据能够被授权的主体访问到

### 安全解决方案
* 黄金法则
  * 认证
    * 认证的强度
      * 你知道什么
      * 你拥有什么
      * 你是什么
  * 授权
  * 审计
> 安全问题需求自上而下的方式进行管理和推动
* 战略计划
* 战术计划
* 操作计划

### 加密知识
* 对称加密算法
  * DES
  * IDEA
  * AES
    * 128，192，256
    * AES-CTR
  * 国密：SM1和SM4
* 分组计算模式：
  ECB/CBC/CFB/OFB/CTR
* 非对称加密算法
  * 认证
  * 签名
  * RSA
  * ECC
    * 目前国际上加密强度最高的非对称加密算法
  * 国密SM2
* 散列算法
  > 加盐salt
  * MD5
  * SHA
    * SHA256
  * 国密SM3

### 身份认证
* 内容：
  * 对外认证
    * 登陆入口
  * 对内认证
    * 内部系统
      * 长期治理
* 威胁
  * 没有认证
  * 弱密码
  * 认证信息泄露
    * 撞库
  * 认证凭证泄露
* 方案
  * 密码强度、第二密码
  * 单点登陆，单点认证
    * CAS流程
    * JWT
      * 使用范围广，单点登陆，最简单
      * 无法注销等问题，可能请求头过大
    * OAuth
      * 第三方认证
      * 认证中心只是维护账户密码
    * OpenID
      * 不提供授权功能
  * 加密防止窃听
  * 多因素校验

### 访问控制
* DAC(自主访问控制)
  * 由所有者维护
* role-BAC(基于角色的访问控制)
  * 防止权限滥用
  * 最小特权原则
* rule-BAC(基于规则的访问指控)
  * 需要添加默认规则
* MAC(强制访问控制)
  * 划分级别：秘密、私人、敏感、公开
  * 机密性不能低读、高写，完整性不能高读、低写

### 威胁评估
* 识别数据
* 识别攻击
* 识别漏洞
  * ATTACK 框架

## WEB安全
### XSS
* 分类
  * 反射型XSS
  * Dom型XSS
  * 持久型XSS
* 威胁
  * 窃取Cookie
    * 同源策略 SOP
    * 通过windows.location跳转实现
    * 通过价值图片
    * 通过加载script
  * 未授权操作
  * 按键记录和钓鱼
* 防护
  * 验证输入 or 验证输出
    * 注入点
  * 编码
    * URL编码
    * 其他编码
  * 检测和过滤
    * 黑名单维护
    * 白名单规则
    * 替换删除（白名单）
  * CSP 内容安全策略
    * 防止外域资源加载

### sql注入

* 分类
  * 修改where 语句
  * 实现任意语句
  * 盲注
* 威胁
  * 绕过验证
  * 任意篡改数据
  * 窃取数据
  * 消耗资源
* 防护
  * 使用PreparedStatement
  * 使用存储过程
  * 验证输入
    * 过滤常见的关键字

### CSRF/SSRF（跨站请求伪造)

* 条件
  * 使用Cookie进行认证
  * 参数中不包含任何隐私信息
* 威胁
  * 攻击成本低
* 防护
  * CSRFToken
  * 二次验证加强防护
* SSRF（Server Side Request Forgery）
  * 请求代理问题
  * 威胁：
    * 内网探测
    * 文件读取
      * 有回显
  * 防护
    * 白名单限制
    * 对协议和资源类型进行限制
    * 请求端限制
      * post方式
      * 请求验证

### 反序列化漏洞

* 成因
  * 恶意的序列化数据
  * 调用链
* 防护
  * 认证
  * 限制序列化和反序列化的类
  * RASP 检测(Runtime Application Self-Protection 实时程序自我保护)

### 信息泄露

* 发现
  * 通过正确的配置文件，避免错误信息展示到前端
  * 黑盒检测
* 常见
  * 版本管理工具中的隐藏文件
    * 上传代码github
    * 扫描工具 HawKeye
* 防护
  * 屏蔽信息
  * 代码检测
  * 人工审计

### 插件漏洞

* 防护
  * 整理插件，剔除无用插件
    * maven dependency Plugin
  * 管理插件补丁更新
    * Version Maven Plugin
    * 问题
      * 补丁可用性
      * 覆盖面不全
      * 更新时间延迟
    * 解决
      * 虚拟补丁
  * 使用公开漏洞库
    * CVE
    * CWE
    * CVSS
    * NVD
    * CNVD
  * OWASP-Dependency-Check
  * Retire.js
* 方式
  * 统计你的应用中引用了哪些插件
  * 管理这些插件中是否有版本更新
  * 检测这些插件是否存在已知公开的漏洞

### 权限提升和持久化

* 方式
  * 水平提升
  * 垂直提升
* 权限提升方式
  * 窃取身份
  * 利用漏洞获得权限
* 持久化(后门)
  * 菜刀
  * 木马
    * 灰鸽子
    * Rootkit 住扎内存
* 方式
  * 获取权限
  * 文件上传漏洞
  * 定时任务，开机启动项
  * RootKit 内核改动
* 防护
  > 纵深防御
  * 最小权限原则
  * IDS检测

### Linux系统安全

> 正确配置用户层权限

* Linux中的认证机制
  * chage 密码生命周期
* Linux中的授权机制
  * 读
  * 写
  * 执行
  * 文件属性设置
    * chattr +i
  * nobody是linux中最小权限
* Linux中的审计机制
  * /var/run/utmp
  * /var/run/wtmp
  * /var/log/secure 记录认证和授权相关的记录
  * /var/log/message syslogd维护，记录特殊事件和消息

### 网络安全

* 内网中的“最小权限原则”
  * 对内网进行水平划分
  * 对内网进行垂直划分
* wifi网络安全
  * 使用WPA2
  * 使用认证技术，强制门户
  * 检测其他可疑热点
* 有线网络
  * 防止arp和dns
* 防止DDos攻击
* 工具
  * Masscan

### docker安全

* docker服务安全
  * namespace 机制（标签机制）
    * 隔离
    * 防止逃逸
  * Capabilities 机制
    * 更加细粒度的授权机制
    * 对操作进行限制
  * CGroups机制
    * 对容器进行资源限制
* docker守护进程
  * 守护进程提供API接口
  * 提供证书的方式
* docker镜像的安全
  * 使用最精简的镜像
  * docker中的最小权限原则
  * 使用扫描工具进行扫描：clair 工具

### 数据库安全

* redis
  * 随机生成32位的密码
  * rename-command config 重命名 命令
* mysql安全
  * LOAD DATA INFILE
    * 密码策略
      * 密码过期
      * 密码重用限制
      * 密码强度评估
      * 密码失败保护
  * 审计
    * mysql-audit
    * MariaDB Audit Plugin
  * 加密
    * keyring_file
    * 第一次启动后生成，需求备份

### 分布式安全

* 常见的攻击
  * 越权访问
  * 间接获取 流动数据
  * 伪装为节点
* 安全
  * Kerberos 认证
    * 申请Keytab
  * 数据加密
* 安全框架
  * Apache Knox
  * Apache Sentry
    * role-Sentry
  * Apache Ranger
    * 所有访问进行审

### 安全标准和框架

* NIST
  * IPDRR 纵深防御方式
    * Identitify
    * Protect
    * Detect
    * Respond
    * Recover
* ISO27000
  * ISO27001
    * 内容
      * 安全策略
      * 信息安全组织
      * 人力资源安全
      * 资产管理
      * 访问控制
      * 密码学
      * 物理和环境安全
      * 操作安全
      * 通信安全
      * 系统获取、开发和维护
      * 供应关系
      * 信息安全事件管理
      * 业务连续性管理中的信息安全考虑
      * 符合性
    * PDCA流程
      * Plan
      * Do
      * Check
      * Action
* COBIT 内控和审计
* ITIL 提高服务质量
* 等保
  * 技术
    * 安全物理环境
    * 安全通信网络
    * 安全区域边界
    * 安全计算环境
    * 安全管理中心
  * 管理
    * 安全管理制度
    * 安全管理机构
    * 安全管理人员
    * 安全建设管理
    * 安全运维管理

### 防火墙

* 分类
  * 包过滤防火墙
    * 过滤 五元组
  * 应用网关防火墙
    * WEB防火墙
    * 代理方式
      * 代理来源IP问题。
  * 状态检测防火墙
    * 以连接的方式进行检测。
    * 还原tcp，udp链路
* 防火墙
  * 保护操作系统漏洞
  * 阻止非法的信息流动
  * 限制可访问的服务和审计
    * 网络流量限制
* 盲区
  * 不能防疫已授权服务中的恶意工具
  * 不能防御不通过防火墙的访问
  * 防火墙自身系统也可能存在缺陷

### WAF

* 工作模式
  * 透明代理
    * 同步https对称密钥
    * 放过，阻断
    * 无法实现服务的认证，内容过滤等功能
  * 反向代理
    * web服务
    * 前置认证平台
    * 隔离后端服务
  * 插件模式
    * AOP技术
    * 问题
      * 性能
      * 强耦合
* 功能服务
  * http解析能力
    * URL，参数
    * HTTP头部
    * POST body
  * http协议的处理
    * 解码能力
* 安全防护
  * 签名匹配
  * 正则匹配
  * 行为分析
* 审计告警
  * 全部日志
  * 统计分析工具
* 数据保护、虚拟补丁
  * 加密Cookie
  * 敏感字段打码
* WAF的选择
  * 功能的完整性
  * 易用性
  * 可配置性
  * 可维护性
  * 规则升级能力

### IDS

* 工作模式
  * NIDS 网络入侵检测系统
  * HIDS 基于主机入侵检测系统
* NIDS
  * Snort
  * Suricata
* HIDS
  * Osquery
* IPS 入侵防护系统
* 蜜罐
  * 蜜罐内的一起行为都是黑客产生的。
  * 低交互蜜罐
  * 高交互蜜罐
  * 优势
    * 不会产生误报
    * 所有行为都是黑客攻击行为
    * 发现可能的新攻击方式
  * 参考： 开源蜜罐测评报告

### RASP （Runtime Application Self Protection)

* openRASP 【需要重新查阅】
  * Hook 列表
  * 覆盖面说明
* 优势
  * 运行在应用的底层
  * 没有误报
  * 基本不需要维护规则
  * 数据保护、虚拟补丁
* 劣势
  * 推广难度
  * RASP部署，需要开发协助部署

### SIEM 安全体系

> 前期在于技术建设，长期在于运营升级

* 流程
  * 制定计划
  * 设计阶段
    * 管理哪些设备、收集哪些数据
    * 安全运营
    * 完整的安全运营流程
  * 建设阶段
    * 建立短期预期，并快速迭代
  * 运营阶段
* 落地的难点
  * 垃圾数据太多
  * 数据维度缺失
  * 人员投入不足

### SDL

> Security Development Lifecycle

* 安全培训
* 需求分析
  * 安全标准
  * 安全指标
  * 风险点评估
* 设计
  * 确定的实施方案
  * 安全指标的响应方案
  * 风险评估
* 开发
  * 限制工具和方法
  * 安全审查
* 测试
  * 符合当初的安全设计方案
  * 动态的安全测试
    * 漏洞扫描
    * 进行模糊测试
* 部署
  * 安全预案
  * 归档
* 响应
  * 安全应急响应小组
* SDL推动方式
  * 基于现有的制度拓展SDL
  * 灵活变通
    * 安全培训加入到内部分享
    * 安全扫描添加到代码提交中
  * 在SDL的覆盖面上，有所取舍

### 业务安全

* 黑产
  * 黑产强调“产业化”
  * 黑客前调的是技术对抗，“黑产”更看中资源对抗
* 业务安全
  * 用户资源
    * 黑名单
  * IP资源
    * 快代理
    * 秒拨
  * 设备资源
    * 模拟器
    * 手机云控
    * 设备指纹
  * 操作资源
    * 按键精灵
    * 区分人和机器
      * 验证码

### 产品安全方案

* IPDRR
  * Identify
  * Protect
  * Detect
  * Respond
  * Recover
* 威胁评估
  * 实时性要求
  * 漏判影响
  * 误伤影响
* 安全产品方案
  > 提高黑产的资源成本
  * 领取条件
  * 满减金额
  * 有效期
* 举例
  * 邀约活动
    * 活跃三天领取红包
  * 抽奖活动
    * 必需注册一个月以上
  * 排行榜
    * 隐藏榜单的计算规则

### 风控系统

* 前端SDK采集数据
  * 用户身份信息
* 规则引擎
  > 特征提取、规则管理
  * 工作模式
    * 同步模式
      * 提现场景
    * 异步模式
    * 离线模式
  * 高效的规则管理
    * Drools
      * Rete算法
    * Nebula
    * Aviator，QLExpress，Groovy
  * 思考
    * 以什么样的模式接入业务
    * 如何进行规则管理
  * 验证流程
    * 短信
    * 人脸
    * 图片验证
    * 滑块
* 风控人员
  * 策略人员
    * 迭代
  * 运营人员
    * 处理
    * 监控
    * 关注动向
    * 感知风险
  * 应急响应人员

### 机器学习

> 机器学习实际上是对人为经验的一种总结，并不具备创新的能力。

* 无监督学习
* 有监督学习
  * 标签问题
    * 时间成本高
    * 覆盖面不全
    * 标准偏差
  * 使用RASP来异常行为的反向打标

### 设备指纹

* 优势
  * 唯一性高
  * 稳定性强
* 挑战

  * IDFA
  * 设备重置后，保持设备指纹不变
  * 设备更新后，保持设备指纹不变
* 信息特征
  * 软件ID：
    * ios设备
      * IDFA
      * IDFV
    * 安卓
      * IMEI
      * MAC
  * 软件静态特征
    * 操作系统版本
    * 手机名称
    * APP版本
  * 硬件静态特征
  * 硬件动态特征
* 设备指纹ID计算
  * 通过判断相似性
  * 可以使用机器学习算法
* 设备指纹对异常设备的识别
  * 系统信息设备识别
  * 硬件识别
  * 系统状态识别
    * 是否状态
    * 地理未知
    * 网络环境
* 都会采购设备指纹计算服务

### 安全运营

* 处理方式
  * 采取适当的拦截策略，防止黑产快速绕过业务安全策略
  * 给予一定的震慑，防止黑产变本加厉
  * 保持情报收集，做好和黑产持续对抗的准备
* 处理黑产的手段
  * 直接拦截
  * 验证拦截
    * 人机验证
    * 同人验证
      * 人脸
      * 朋友，订单
  * 假数据拦截
* 运营手段
  * 情报收集
  * 钓鱼执法
  * 案件打击
* 案例
  * 知道黑产是谁
  * 业务损失金额和黑产的收益金额
  * 提供证据
    * 黑产服务器上的日志和名下资产记录
    * 公开侵权数据
    * 自身服务器日志

### 规划公司的安全防疫体系

* 理想情况下，应当以安全制度为基础规范人的行为，避免安全问题的发生
* 公司对安全需求不明确的时候，我们需求找出显著的安全问题，表现出安全工作能够产出的收益
* 当有真实的攻击发生时，我们要先快速阻断攻击，再逐步深入，彻底解决安全问题

### 前端安全

* 混淆
  * 清晰代码无序化
  * 简单逻辑复杂化
  * 固定字符串动态化
  * 反调试
    * 域名锁定
    * 无限断点
* 混淆的影响
  * 增加代码体积
  * 增加额外的执行逻辑
  * 混淆后代码很难调试

### 安全岗位

* 渗透测试
  * 安全攻击水平
* 安全运维
  * 熟练掌握安全知识和工具
* 业务安全
  * 了解业务逻辑
  * 了解灰产
* 安全开发
  * 开发
  * 算法
* 移动安全
* AI安全
* 数据安全
  * 合规审查安全
* 面试：
  * 安全专业背景
  * 攻击渗透能力
    * WebGoat
    * XCTF联赛
    * WSRC
  * 开发能力、算法能力
    * openVAS
  * 安全研究能

### 安全个人发展

* 《白帽子讲web安全》《黑客攻防技术宝典》
* 《Metasploit渗透测试指南》
* WebGoat、Pwnable.kr
* XCTF联赛
* 《互联网企业安全高级指南》、《企业安全建设指南》、《大型互联网企业安全架构》
* 安全证书：CISP、CISSP、OSCP
* FreeBuf、安全客、安全牛
